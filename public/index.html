<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Telegram Auth Debug</title>
</head>
<body>

<h2 id="status">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏...</h2>

<script>
console.log("üîµ WebApp —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª");

if (window.Telegram && Telegram.WebApp) {
    Telegram.WebApp.ready();
    console.log("üü¢ Telegram WebApp –≥–æ—Ç–æ–≤");
} else {
    console.log("üî¥ Telegram.WebApp –ù–ï –Ω–∞–π–¥–µ–Ω");
    document.getElementById("status").innerText = "‚ùå Telegram WebApp –Ω–µ –Ω–∞–π–¥–µ–Ω";
}

async function init() {
    const initData = Telegram.WebApp.initData;
    const unsafe = Telegram.WebApp.initDataUnsafe;

    console.log("üìå initData =", initData);
    console.log("üìå initDataUnsafe =", unsafe);

    if (!unsafe || !unsafe.user) {
        document.getElementById("status").innerText = "‚ùå –ù–µ—Ç Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏";
        return;
    }

    console.log("üü¢ Telegram userId:", unsafe.user.id);

    const response = await fetch("/api/init", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ initData })
    });

    const data = await response.json();
    console.log("–û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:", data);

    if (data.ok) {
        document.getElementById("status").innerText =
            "‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω. –í–∞—à ID: " + unsafe.user.id;
    } else {
        document.getElementById("status").innerText =
            "‚ùå –û—à–∏–±–∫–∞: " + JSON.stringify(data);
    }
}

init();
</script>

</body>
</html>
